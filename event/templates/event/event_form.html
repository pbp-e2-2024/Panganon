<!-- templates/events/event_form.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.0/dist/tailwind.min.css" rel="stylesheet">
    <title>{{ form_title }} Event</title>
</head>
<body class="bg-gray-100">

{% block content %}
<div class="bg-white rounded-lg shadow sm:max-w-md sm:w-full sm:mx-auto sm:overflow-hidden mt-10">
    <div class="px-4 py-8 sm:px-10">
        <h1 class="text-2xl font-bold mb-6">{{ form_title }} Event</h1>
        
        <form id="eventForm" method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="relative">
                <label for="event-name" class="block text-gray-700 mb-2">Event Name</label>
                <input type="text" id="event-name" name="name" placeholder="Event Name" class="rounded-lg border border-gray-300 w-full py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent" value="{{ form.name.value }}"/>
            </div>

            <div class="relative">
                <label for="event-description" class="block text-gray-700 mb-2">Description</label>
                <textarea id="event-description" name="description" placeholder="Description" class="rounded-lg border border-gray-300 w-full py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent">{{ form.description.value }}</textarea>
            </div>

            <div class="relative">
                <label for="event-location" class="block text-gray-700 mb-2">Location</label>
                <input type="text" id="event-location" name="location" placeholder="Location" class="rounded-lg border border-gray-300 w-full py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent" value="{{ form.location.value }}"/>
            </div>

            <div class="relative">
                <label for="event-date" class="block text-gray-700 mb-2">Date</label>
                <input type="datetime-local" id="event-date" name="date" class="rounded-lg border border-gray-300 w-full py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent" value="{{ form.date.value|date:'Y-m-d H:i' }}"/>
            </div>

            <div class="flex justify-end mt-4">
                <a href="{% url 'event_list' %}" class="text-gray-500 hover:underline mr-4">Cancel</a>
                <button type="submit" id="submitBtn" class="py-2 px-4 bg-blue-500 hover:bg-blue-600 text-white rounded-md">{{ form_button_text }}</button>
            </div>
        </form>

        <div id="formErrors" class="text-red-500 mt-4 hidden"></div>

        <div class="relative mt-6">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-300"></div>
            </div>
            <div class="relative flex justify-center text-sm leading-5">
                <span class="px-2 text-gray-500 bg-white">
                    Kriteria
                </span>
            </div>
        </div>
    </div>

    <div class="px-4 py-6 border-t-2 border-gray-200 bg-gray-50 sm:px-10">
        <p class="text-xs leading-5 text-gray-500">
            This data is displayed for information and can change
        </p>
    </div>
</div>

<script>
    document.getElementById('eventForm').addEventListener('submit', function(e) {
        e.preventDefault();
        let form = this;
        let formData = new FormData(form);
        let url = form.action;

        fetch(url, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = `/events/${data.event_id}/`;
            } else {
                let errorDiv = document.getElementById('formErrors');
                errorDiv.innerHTML = '';
                for (let key in data.errors) {
                    errorDiv.innerHTML += `<p>${data.errors[key]}</p>`;
                }
                errorDiv.classList.remove('hidden');
            }
        });
    });
</script>
{% endblock %}
