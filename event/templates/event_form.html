<!-- templates/events/event_form.html -->
{% extends 'base.html' %}

{% block title %}{{ form_title }} Event{% endblock %}

{% block content %}
<div class="container mx-auto">
    <div class="bg-white p-8 shadow-md rounded-lg">
        <h1 class="text-2xl font-bold mb-6">{{ form_title }} Event</h1>

        <form id="eventForm" method="post" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label class="block text-gray-700 mb-2">Event Name</label>
                {{ form.name|attr:"class:w-full p-2 border border-gray-300 rounded-lg" }}
            </div>

            <div>
                <label class="block text-gray-700 mb-2">Description</label>
                {{ form.description|attr:"class:w-full p-2 border border-gray-300 rounded-lg" }}
            </div>

            <div>
                <label class="block text-gray-700 mb-2">Location</label>
                {{ form.location|attr:"class:w-full p-2 border border-gray-300 rounded-lg" }}
            </div>

            <div>
                <label class="block text-gray-700 mb-2">Date</label>
                {{ form.date|attr:"class:w-full p-2 border border-gray-300 rounded-lg" }}
            </div>

            <div class="flex justify-end">
                <a href="{% url 'event_list' %}" class="text-gray-500 hover:underline mr-4">Cancel</a>
                <button type="submit" id="submitBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">{{ form_button_text }}</button>
            </div>
        </form>

        <div id="formErrors" class="text-red-500 mt-4 hidden"></div>
    </div>
</div>

<script>
    document.getElementById('eventForm').addEventListener('submit', function(e) {
        e.preventDefault();
        let form = this;
        let formData = new FormData(form);
        let url = form.action;

        fetch(url, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = `/events/${data.event_id}/`;
            } else {
                let errorDiv = document.getElementById('formErrors');
                errorDiv.innerHTML = '';
                for (let key in data.errors) {
                    errorDiv.innerHTML += `<p>${data.errors[key]}</p>`;
                }
                errorDiv.classList.remove('hidden');
            }
        });
    });
</script>
{% endblock %}
